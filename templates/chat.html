<!DOCTYPE html>
<html>

<head>
    <title>Rust Chat</title>
    <style type="text/css">
        html,
        body,
        #chat {
            padding: 0;
            margin: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #chat {
            display: flex;
            flex-direction: column;
        }

        #message-container {
            overflow-y: scroll;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        #messages {
            width: 100%;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        #message-form {
            overflow: hidden;
            display: flex;
            flex: column;
            padding: 1rem;
        }

        #message-input {
            border: none;
            background: rgba(128, 128, 128, 0.3);
            border-radius: 1rem;
            overflow: hidden;
            height: 1rem;
            width: 100%;
            padding: 1rem;
            margin: 1rem;
        }
    </style>
</head>

<body>
    <div id="chat">
        <div id="message-container">
            <div id="messages">

            </div>
        </div>
        <div id="message-form">
            <textarea id="message-input"></textarea>
        </div>
    </div>

    <template id="tmp-chat-message">
        {% include "ugc/chat.html" %}
    </template>

    <script>
        // WebSocket
        let ws = new WebSocket("ws://xf.localhost/rust-chat");
        pushMessage("Connecting...");

        ws.addEventListener('close', function (event) {
            console.log(event);
            pushMessage("Connection closed.");
        });

        ws.addEventListener('error', function (event) {
            console.log(event);
        });

        ws.addEventListener('message', function (event) {
            console.log(event);
            pushMessage(event.data);
        });

        ws.addEventListener('open', function (event) {
            console.log(event);
            pushMessage("Connected!");
        });

        function pushMessage(message, user) {
            let template = document.getElementById('tmp-chat-message').content.cloneNode(true);
            template.querySelector('.message').innerHTML = message;
            document.getElementById('messages').appendChild(template);
        }

        // Form
        document.getElementById('message-input').addEventListener('keydown', function (event) {
            if (event.which === 13) {
                event.preventDefault();
                ws.send(this.value);
                this.value = "";
                return false;
            }
        });
    </script>
</body>

</html>